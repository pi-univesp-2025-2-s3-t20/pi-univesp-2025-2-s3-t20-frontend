<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Relatórios</title>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: Arial, sans-serif;
      position: relative; overflow: hidden;
    }

    body::before {
      content: "";
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: url('img/fotos_salgados.jpg') no-repeat center center fixed;
      background-size: cover; opacity: 0.3; z-index: -1;
    }

    .container {
      padding: 40px;
      background-color: rgba(255,255,255,0.9);
      margin: 50px auto;
      width: 80%;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }

    .botoes-topo {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-bottom: 20px;
    }

    .botoes-topo button {
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      color: white;
      background-color: #6c757d; /* cinza padrão */
      transition: background-color 0.2s;
    }

    .botoes-topo button:hover {
      background-color: #5a6268; /* cinza escuro no hover */
    }

    #relatorios li {
      font-size: 16px;
      margin: 8px 0;
    }

    .loader {
      border: 8px solid #f3f3f3; /* Light grey */
      border-top: 8px solid #3498db; /* Blue */
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 50px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="botoes-topo">
      <button id="btn-voltar">Voltar</button>
      <button id="btn-sair">Sair</button>
    </div>

    <h1>Relatórios de Vendas</h1>
    <div id="loader" class="loader"></div>
    <ul id="relatorios" class="hidden">
      <!-- Conteúdo será preenchido via JS -->
    </ul>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      async function carregarRelatorios() {
        const loader = document.getElementById('loader');
        const relatoriosList = document.getElementById('relatorios');

        try {
          const token = localStorage.getItem('accessToken');
          if (!token) {
            throw new Error('Token de autenticação não encontrado.');
          }

          const resposta = await fetch(`${API_BASE_URL}/vendas/resumo`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });

          if (!resposta.ok) {
            if (resposta.status === 401) {
              localStorage.clear();
              window.location.href = 'login.html';
            }
            throw new Error(`Erro HTTP: ${resposta.status}`);
          }

          const relatorios = await resposta.json();
          relatoriosList.innerHTML = `
            <li><strong>Receita Total Geral:</strong> R$ ${relatorios.receitaTotal.toFixed(2)}</li>
            <li><strong>Número Total de Vendas:</strong> ${relatorios.totalVendas}</li>
          `;
        } catch (erro) {
          console.error('Falha ao carregar relatórios:', erro);
          alert('Erro ao carregar relatórios.');
        } finally {
          loader.classList.add('hidden');
          relatoriosList.classList.remove('hidden');
        }
      }
      carregarRelatorios();
    });

    // Botão Voltar
    document.getElementById('btn-voltar').addEventListener('click', () => {
      window.location.href = 'index.html';
    });

    // Botão Sair
    document.getElementById('btn-sair').addEventListener('click', () => {
      localStorage.clear();
      alert('Você saiu do sistema.');
      window.location.href = 'login.html';
    });
  </script>
</body>
</html>
